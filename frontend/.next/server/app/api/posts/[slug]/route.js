"use strict";(()=>{var e={};e.id=991,e.ids=[991],e.modules={1185:e=>{e.exports=require("mongoose")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1769:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>b,requestAsyncStorage:()=>x,routeModule:()=>f,serverHooks:()=>w,staticGenerationAsyncStorage:()=>v});var n={};r.r(n),r.d(n,{DELETE:()=>h,GET:()=>g,PUT:()=>m,dynamic:()=>p});var s=r(9303),a=r(8716),i=r(670),o=r(7070),l=r(4544),u=r(1201),d=r(9137),c=r(4697);let p="force-dynamic";async function g(e,{params:t}){try{await (0,l.Z)();let{slug:e}=t;if(!e||"string"!=typeof e)return o.NextResponse.json({error:"Invalid slug provided"},{status:400});let r=await u.Z.findOneAndUpdate({slug:e,isDeleted:!1,status:"published"},{$inc:{viewCount:1}},{new:!0,runValidators:!1});if(!r)return o.NextResponse.json({error:"Post not found"},{status:404});return o.NextResponse.json({post:r})}catch(e){return console.error("GET /api/posts/[slug] error:",e),o.NextResponse.json({error:"Internal server error"},{status:500})}}async function m(e,{params:t}){try{await (0,l.Z)();let{slug:r}=t,n=await e.json();if(!r||"string"!=typeof r)return o.NextResponse.json({error:"Invalid slug provided"},{status:400});let s=d.rw.parse(n);if(!await u.Z.findOne({slug:r,isDeleted:!1}))return o.NextResponse.json({error:"Post not found"},{status:404});s.content&&(s.content=(0,c.jW)(s.content));let a=await u.Z.findOneAndUpdate({slug:r,isDeleted:!1},{...s},{new:!0,runValidators:!0});return o.NextResponse.json({message:"Post updated successfully",post:a})}catch(e){if(console.error("PUT /api/posts/[slug] error:",e),"ZodError"===e.name)return o.NextResponse.json({error:"Validation failed",details:e.errors},{status:400});if("MongoServerError"===e.name&&11e3===e.code)return o.NextResponse.json({error:"A post with this title already exists"},{status:409});return o.NextResponse.json({error:"Internal server error"},{status:500})}}async function h(e,{params:t}){try{await (0,l.Z)();let{slug:e}=t;if(!e||"string"!=typeof e)return o.NextResponse.json({error:"Invalid slug provided"},{status:400});if(!await u.Z.findOneAndUpdate({slug:e,isDeleted:!1},{isDeleted:!0},{new:!0}))return o.NextResponse.json({error:"Post not found or already deleted"},{status:404});return o.NextResponse.json({message:"Post deleted successfully"})}catch(e){return console.error("DELETE /api/posts/[slug] error:",e),o.NextResponse.json({error:"Internal server error"},{status:500})}}let f=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/posts/[slug]/route",pathname:"/api/posts/[slug]",filename:"route",bundlePath:"app/api/posts/[slug]/route"},resolvedPagePath:"C:\\Users\\aakar\\OneDrive\\Desktop\\delete\\second\\app\\api\\posts\\[slug]\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:x,staticGenerationAsyncStorage:v,serverHooks:w}=f,y="/api/posts/[slug]/route";function b(){return(0,i.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:v})}},4544:(e,t,r)=>{r.d(t,{Z:()=>o});var n=r(1185),s=r.n(n);let a=process.env.MONGODB_URI,i=global.mongoose||{conn:null,promise:null};global.mongoose||(global.mongoose=i);let o=async function(){if(!a)throw Error("Please define the MONGODB_URI environment variable inside .env.local");if(i.conn)return i.conn;i.promise||(i.promise=s().connect(a,{bufferCommands:!1}).then(e=>e));try{i.conn=await i.promise}catch(e){throw i.promise=null,e}return i.conn}},1201:(e,t,r)=>{r.d(t,{Z:()=>l});var n=r(1185),s=r.n(n);async function a(e,t){let r=e.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[-\s]+/g,"-").replace(/^-+|-+$/g,"");r||(r="untitled"),r.length>100&&(r=r.substring(0,100));let n=r,s=1;for(;await i(n,t);)if(n=`${r}-${s}`,++s>1e3){n=`${r}-${Date.now()}`;break}return n}async function i(e,t){let r={slug:e,isDeleted:!1};return t&&(r._id={$ne:t}),!!await s().model("Post").findOne(r)}let o=new n.Schema({title:{type:String,required:[!0,"Title is required"],trim:!0,maxlength:[200,"Title cannot exceed 200 characters"],minlength:[3,"Title must be at least 3 characters"]},content:{type:String,required:[!0,"Content is required"],minlength:[10,"Content must be at least 10 characters"]},slug:{type:String,required:!0,unique:!0,lowercase:!0,trim:!0,match:[/^[a-z0-9-]+$/,"Slug can only contain lowercase letters, numbers, and hyphens"]},excerpt:{type:String,maxlength:[300,"Excerpt cannot exceed 300 characters"]},status:{type:String,enum:["draft","published","archived"],default:"draft"},featuredImage:{type:String,validate:{validator:function(e){return!e||/^https?:\/\/.+\.(jpg|jpeg|png|gif|webp)$/i.test(e)},message:"Featured image must be a valid image URL"}},tags:[{type:String,trim:!0,lowercase:!0}],metaTitle:{type:String,maxlength:[60,"Meta title cannot exceed 60 characters"]},metaDescription:{type:String,maxlength:[160,"Meta description cannot exceed 160 characters"]},author:{type:String,default:"Admin",trim:!0},viewCount:{type:Number,default:0,min:0},isDeleted:{type:Boolean,default:!1}},{timestamps:!0,toJSON:{virtuals:!0},toObject:{virtuals:!0}});o.virtual("readingTime").get(function(){return Math.ceil(this.content.replace(/<[^>]*>/g,"").split(/\s+/).length/200)}),o.pre("validate",async function(e){(this.isNew||this.isModified("title"))&&this.title&&(this.slug=await a(this.title,this._id?.toString())),(this.isNew||this.isModified("content"))&&this.content&&(this.excerpt=this.excerpt||function(e){let t=e.replace(/<[^>]*>/g,"").trim();return t.length>300?t.substring(0,300)+"...":t}(this.content)),console.log("Validating post:",{title:this.title,slug:this.slug}),e()}),o.index({status:1,createdAt:-1}),o.index({tags:1}),o.index({title:"text",content:"text"}),o.index({isDeleted:1,status:1});let l=s().models.Post||s().model("Post",o)},4697:(e,t,r)=>{r.d(t,{jW:()=>a});var n=r(2630);let s=require("jsdom");function a(e){let t=new s.JSDOM("").window;return(0,n.Z)(t).sanitize(e,{ALLOWED_TAGS:["p","br","strong","em","u","s","h1","h2","h3","h4","h5","h6","blockquote","ul","ol","li","a","img","code","pre"],ALLOWED_ATTR:["href","src","alt","title","target","rel"],ALLOW_DATA_ATTR:!1})}},9137:(e,t,r)=>{r.d(t,{bI:()=>i,rY:()=>s,rw:()=>a});var n=r(9133);let s=n.z.object({title:n.z.string().min(3,"Title must be at least 3 characters").max(200,"Title cannot exceed 200 characters").trim(),content:n.z.string().min(10,"Content must be at least 10 characters"),status:n.z.enum(["draft","published","archived"]).optional(),tags:n.z.array(n.z.string().trim().toLowerCase()).optional(),featuredImage:n.z.string().url().optional().or(n.z.literal("")),metaTitle:n.z.string().max(60,"Meta title cannot exceed 60 characters").optional(),metaDescription:n.z.string().max(160,"Meta description cannot exceed 160 characters").optional()}),a=s.partial(),i=n.z.object({page:n.z.string().transform(Number).pipe(n.z.number().min(1).max(1e3)).default("1"),limit:n.z.string().transform(Number).pipe(n.z.number().min(1).max(50)).default("10"),status:n.z.enum(["draft","published","archived"]).optional(),search:n.z.string().optional(),tags:n.z.string().optional(),sortBy:n.z.enum(["createdAt","updatedAt","viewCount","title"]).default("createdAt"),sortOrder:n.z.enum(["asc","desc"]).default("desc")})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[276,972,351],()=>r(1769));module.exports=n})();