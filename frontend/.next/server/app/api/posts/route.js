"use strict";(()=>{var e={};e.id=990,e.ids=[990],e.modules={1185:e=>{e.exports=require("mongoose")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4310:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>b,patchFetch:()=>y,requestAsyncStorage:()=>x,routeModule:()=>f,serverHooks:()=>v,staticGenerationAsyncStorage:()=>w});var a={};r.r(a),r.d(a,{GET:()=>h,POST:()=>g,dynamic:()=>m});var n=r(9303),s=r(8716),i=r(670),o=r(7070),l=r(4544),c=r(1201),u=r(9137);let d=new Map;var p=r(4697);let m="force-dynamic";async function g(e){try{let t=e.ip||e.headers.get("x-forwarded-for")||"unknown";if(!function(e,t,r){let a=Date.now(),n=(d.get(e)||[]).filter(e=>a-e<36e5);return!(n.length>=10)&&(n.push(a),d.set(e,n),!0)}(t,0,0))return o.NextResponse.json({error:"Rate limit exceeded. Please try again later."},{status:429});await (0,l.Z)();let r=await e.json(),a=u.rY.parse(r),n=(0,p.jW)(a.content),s=new c.Z({...a,content:n,author:"Admin"});return await s.save(),o.NextResponse.json({message:"Post created successfully",post:{id:s._id,title:s.title,slug:s.slug,status:s.status,createdAt:s.createdAt}},{status:201})}catch(e){if(console.error("POST /api/posts error:",e),"ZodError"===e.name)return o.NextResponse.json({error:"Validation failed",details:e.errors},{status:400});if("MongoServerError"===e.name&&11e3===e.code)return o.NextResponse.json({error:"A post with this title already exists"},{status:409});return o.NextResponse.json({error:"Internal server error"},{status:500})}}async function h(e){try{await (0,l.Z)();let{searchParams:t}=new URL(e.url),r=Object.fromEntries(t.entries()),{page:a,limit:n,status:s,search:i,tags:d,sortBy:p,sortOrder:m}=u.bI.parse(r),g={isDeleted:!1};if(s?g.status=s:g.status="published",i&&(g.$text={$search:i}),d){let e=d.split(",").map(e=>e.trim().toLowerCase());g.tags={$in:e}}let h={};h[p]="desc"===m?-1:1;let f=(a-1)*n,[x,w]=await Promise.all([c.Z.find(g).sort(h).skip(f).limit(n).select("-content -isDeleted").lean(),c.Z.countDocuments(g)]),v=Math.ceil(w/n);return o.NextResponse.json({posts:x,pagination:{currentPage:a,totalPages:v,totalPosts:w,hasNextPage:a<v,hasPrevPage:a>1,limit:n}})}catch(e){if(console.error("GET /api/posts error:",e),"ZodError"===e.name)return o.NextResponse.json({error:"Invalid query parameters",details:e.errors},{status:400});return o.NextResponse.json({error:"Internal server error"},{status:500})}}let f=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/posts/route",pathname:"/api/posts",filename:"route",bundlePath:"app/api/posts/route"},resolvedPagePath:"C:\\Users\\aakar\\OneDrive\\Desktop\\delete\\second\\app\\api\\posts\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:x,staticGenerationAsyncStorage:w,serverHooks:v}=f,b="/api/posts/route";function y(){return(0,i.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:w})}},4544:(e,t,r)=>{r.d(t,{Z:()=>o});var a=r(1185),n=r.n(a);let s=process.env.MONGODB_URI,i=global.mongoose||{conn:null,promise:null};global.mongoose||(global.mongoose=i);let o=async function(){if(!s)throw Error("Please define the MONGODB_URI environment variable inside .env.local");if(i.conn)return i.conn;i.promise||(i.promise=n().connect(s,{bufferCommands:!1}).then(e=>e));try{i.conn=await i.promise}catch(e){throw i.promise=null,e}return i.conn}},1201:(e,t,r)=>{r.d(t,{Z:()=>l});var a=r(1185),n=r.n(a);async function s(e,t){let r=e.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[-\s]+/g,"-").replace(/^-+|-+$/g,"");r||(r="untitled"),r.length>100&&(r=r.substring(0,100));let a=r,n=1;for(;await i(a,t);)if(a=`${r}-${n}`,++n>1e3){a=`${r}-${Date.now()}`;break}return a}async function i(e,t){let r={slug:e,isDeleted:!1};return t&&(r._id={$ne:t}),!!await n().model("Post").findOne(r)}let o=new a.Schema({title:{type:String,required:[!0,"Title is required"],trim:!0,maxlength:[200,"Title cannot exceed 200 characters"],minlength:[3,"Title must be at least 3 characters"]},content:{type:String,required:[!0,"Content is required"],minlength:[10,"Content must be at least 10 characters"]},slug:{type:String,required:!0,unique:!0,lowercase:!0,trim:!0,match:[/^[a-z0-9-]+$/,"Slug can only contain lowercase letters, numbers, and hyphens"]},excerpt:{type:String,maxlength:[300,"Excerpt cannot exceed 300 characters"]},status:{type:String,enum:["draft","published","archived"],default:"draft"},featuredImage:{type:String,validate:{validator:function(e){return!e||/^https?:\/\/.+\.(jpg|jpeg|png|gif|webp)$/i.test(e)},message:"Featured image must be a valid image URL"}},tags:[{type:String,trim:!0,lowercase:!0}],metaTitle:{type:String,maxlength:[60,"Meta title cannot exceed 60 characters"]},metaDescription:{type:String,maxlength:[160,"Meta description cannot exceed 160 characters"]},author:{type:String,default:"Admin",trim:!0},viewCount:{type:Number,default:0,min:0},isDeleted:{type:Boolean,default:!1}},{timestamps:!0,toJSON:{virtuals:!0},toObject:{virtuals:!0}});o.virtual("readingTime").get(function(){return Math.ceil(this.content.replace(/<[^>]*>/g,"").split(/\s+/).length/200)}),o.pre("validate",async function(e){(this.isNew||this.isModified("title"))&&this.title&&(this.slug=await s(this.title,this._id?.toString())),(this.isNew||this.isModified("content"))&&this.content&&(this.excerpt=this.excerpt||function(e){let t=e.replace(/<[^>]*>/g,"").trim();return t.length>300?t.substring(0,300)+"...":t}(this.content)),console.log("Validating post:",{title:this.title,slug:this.slug}),e()}),o.index({status:1,createdAt:-1}),o.index({tags:1}),o.index({title:"text",content:"text"}),o.index({isDeleted:1,status:1});let l=n().models.Post||n().model("Post",o)},4697:(e,t,r)=>{r.d(t,{jW:()=>s});var a=r(2630);let n=require("jsdom");function s(e){let t=new n.JSDOM("").window;return(0,a.Z)(t).sanitize(e,{ALLOWED_TAGS:["p","br","strong","em","u","s","h1","h2","h3","h4","h5","h6","blockquote","ul","ol","li","a","img","code","pre"],ALLOWED_ATTR:["href","src","alt","title","target","rel"],ALLOW_DATA_ATTR:!1})}},9137:(e,t,r)=>{r.d(t,{bI:()=>i,rY:()=>n,rw:()=>s});var a=r(9133);let n=a.z.object({title:a.z.string().min(3,"Title must be at least 3 characters").max(200,"Title cannot exceed 200 characters").trim(),content:a.z.string().min(10,"Content must be at least 10 characters"),status:a.z.enum(["draft","published","archived"]).optional(),tags:a.z.array(a.z.string().trim().toLowerCase()).optional(),featuredImage:a.z.string().url().optional().or(a.z.literal("")),metaTitle:a.z.string().max(60,"Meta title cannot exceed 60 characters").optional(),metaDescription:a.z.string().max(160,"Meta description cannot exceed 160 characters").optional()}),s=n.partial(),i=a.z.object({page:a.z.string().transform(Number).pipe(a.z.number().min(1).max(1e3)).default("1"),limit:a.z.string().transform(Number).pipe(a.z.number().min(1).max(50)).default("10"),status:a.z.enum(["draft","published","archived"]).optional(),search:a.z.string().optional(),tags:a.z.string().optional(),sortBy:a.z.enum(["createdAt","updatedAt","viewCount","title"]).default("createdAt"),sortOrder:a.z.enum(["asc","desc"]).default("desc")})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,972,351],()=>r(4310));module.exports=a})();